<app-buyer-navbar [itemAddedToCart]="pushItemToNavbar"></app-buyer-navbar>

<div class="clearheader"></div>

<!--
Bryan Vu contributed most of this buyer portal page.
-->

<div class="container-fluid" *ngIf="buyer">
  &nbsp;
  <div class="container">
    <div class="row justify-content-md">
      <div>
        <h4 class="page-header">Welcome {{buyer.data.first_name}}!</h4>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        </div>
        &nbsp;
        <button type="button" routerLink="/buyer/make-request" class="btn btn-block" style="background-color: #1761a0; color: white">Submit
          New Request</button>
    </div>

    <br>

    <div class="row justify-content-md" ng-cloak>
      <div class="col">
        <h3>{{buyer.data.first_name}}'s Requests</h3>
      </div>
      <div class="input-group col searchBox">
        <input type="text" class="form-control" placeholder="Search Requests" [(ngModel)]="filter">

      </div>
    </div>
  </div>
  &nbsp;
  <li class="card container">
    &nbsp;
    <table class="table table-striped table-sm" style="background-color: #282d32; color: white">
      <thead>
        <tr style="text-align:center">
          <th>Name</th>
          <th style="width: 300px;">Status</th>
          <th style="width: 300px;">Offers</th>
          <th style="width: 300px;">Time Left</th>
        </tr>
      </thead>
    </table>

    <mat-accordion>
      <mat-expansion-panel id="requestExpansionId" *ngFor="let request of requestList | filter:filter | paginate: {itemsPerPage: 25, currentPage: p}" (opened)="expanded(request._id)">
        <mat-expansion-panel-header style="text-align:center">
          <mat-panel-title style="width: 180px" id="requestTitle">
            {{request.title}}
          </mat-panel-title>
          <mat-panel-title style="width:200px">
            Pending
          </mat-panel-title>
          <mat-panel-title style="width: 75px">
            {{request.offerCount}}
          </mat-panel-title>
          <mat-panel-title style="width: 90px">
            {{request.deadline}}
          </mat-panel-title>
          <mat-panel-title id="selectedRequestId" hidden>
            {{request._id}}
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="container" style="border:3px solid black; background-color: #dcdde1">
          &nbsp;
          <mat-panel-title>
            Request Description:
          </mat-panel-title>
          <mat-panel-title>
            <div [innerHTML]="request.description"></div>
          </mat-panel-title>
          <br>
          <mat-panel-title>
            Offers:
          </mat-panel-title>
          <br>
          <table class="table table-striped table-sm" style="background-color: #487eb0; color: white">
            <thead>
              <tr style="text-align:center;">
                <th>Title</th>
                <th>Submission Date</th>
                <th>Price</th>
              </tr>
            </thead>
          </table>

          <mat-expansion-panel *ngFor="let offer of offerList" style="background-color: #f5f6fa">
            <mat-expansion-panel-header>
              <mat-panel-title id="offerTitle" style="margin-left: 3%">
                {{offer.title}}
              </mat-panel-title>
              <mat-panel-title id="offerSubDate" style="margin-left: 25%">
                offer-sub-date
              </mat-panel-title>
              <mat-panel-title id="offerPrice" style="margin-left: 30%">
                ${{offer.price}}
              </mat-panel-title>
              <mat-panel-title id="offerId" hidden>
                {{offer._id}}
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="container" style="border:3px solid #7f8fa6">
              &nbsp;
              <mat-panel-title>
                Offer Details:
              </mat-panel-title>
              <mat-panel-title id="offerDescription">
                {{offer.description}}
              </mat-panel-title>
              <mat-panel-title style="margin-left: 85%">
                <button mat-button (click)="acceptOffer()" id="acceptOfferButton" style="background-color: #8c7ae6; color: white;">Accept
                  Offer</button>
              </mat-panel-title>
              &nbsp;
            </div>
          </mat-expansion-panel>
          &nbsp;
        </div>

        <!----
        <mat-form-field>
          <input matInput placeholder="Age">
        </mat-form-field>-->
      </mat-expansion-panel>
    </mat-accordion>

    &nbsp;

    <pagination-controls (pageChange)="p = $event" previousLabel="Previous" nextLabel="Next" directionLinks="true"
      autoHide="true">
    </pagination-controls>

    <!----
    <div class="row">
      <div class="col-md-auto">
        <h4>{{request.title}}</h4>
      </div>
      <div class="col">
        <p><b>Offer count:</b> {{request.offerCount}}</p>
      </div>
    </div>

    <p><b>Deadline:</b> {{request.deadline}}</p>
    <p><b>Description:</b> {{request.description}}</p>
    <div class="col-sm-12" style="text-align: right;">
      <button type="button" routerLink="/request/{{request._id}}" class="btn">View Offers</button>
    </div>
    <br>-->
  </li>
</div>



<div class="clearfooter"></div>
